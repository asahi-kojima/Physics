# 確率
## 目的


## 確率密度関数
実数が確率的に生成される場合には、特定の実数が生成される確率というものは考えず、ある幅を持たせて議論する。例えば変数$x$を確率変数とする（確率変数とは、変数の具体的な値が確率的に決まるということである）。この確率変数は$[0,1]$の値を持つとして、
- x : x=0.123987456...が発生する確率は、、、、
- o : 

これをもっと正確に言うために、dxを無限小として確率変数$X$の値が$[x, x + dx]$の間になる確率を$\rho(x)dx$と定める。なお$X$が値を持たない区間の$\rho(x)$は$0$とする。

また、全区間で積分したら1にならないといけないので、 $\int_{-\infty}^\infty\rho(x)dx =1$ を満たさないといけない。なお、 $\rho(x)$ が例えば区間 $[0,1]$ でしか値を持たなければ、この積分は実質 $\int_{0}^1\rho(x)dx =1$ になる。ここは確率変数毎に便利な区間に適宜変更していい。

例えば確率変数$X$が$[0,1]$の一様乱数とする。この時、

## 累積分布関数
確率密度関数が、確率変数がある区間に存在している確率を表していたのに対し、
累積分布関数 $F(x)$ はある基準から指定した値までの。定義を見た方が早い。
確率密度関数を利用する事を以下のように定義される。
$$
F(x) \equiv P(-\infty <= X <= x) = \int_{-\infty}^x \rho(t)~dt
$$

一様分布の時は

## § 一様乱数

## <span style="color:blue">§ 確率変数の変換</span>
確率変数 $X$ を適当な関数 $g(x)$ で変換した時の分布を考えることにする。この変換後の確率変数を $Y$ としておく。ここでのゴールは確率変数$y$の確率密度関数 $\tilde{\rho}$ の関数型を知ることである。ここでは関数$g$は単調増加とするが、単調減少もほぼ同じである。まず以下の式が成り立つ。
$$
\begin{align}
P(~g(a) \leq y\leq g(b)~) =P(a\leq x \leq b)
\end{align}
$$
また定義に依れば、以下も成立する。
$$
\begin{align}
P(~g(a) \leq y\leq g(b)~) = \int_{g(a)}^{g(b)}\tilde{\rho}(y)dy
\end{align}
$$

後者の式を出発点として、前者の式を利用すると、以下のことが分かる。関数$g$の逆関数を$f$とすると、

$$
\begin{align}
\int_{g(a)}^{g(b)}\tilde{\rho}(y)dy
&=P(~g(a) \leq y\leq g(b)~) \\
&= P(a\leq x \leq b)\\
&= \int_a^b \rho(x)dx\\
&= \int_{g(a)}^{g(b)}\rho(f(y))\frac{dx}{dy}dy\\
&= \int_{g(a)}^{g(b)}\rho(f(y))\frac{df(y)}{dy}dy
\end{align}
$$

最初と最後の比較により、以下のことが分かった。

$$
\begin{align}
\tilde{\rho}
&~=~\rho(f(y))\frac{df(y)}{dy}\\
&~=~\rho(f(y))\frac{dg^{-1}(y)}{dy}\\
&~=~\frac{\rho\left(
    g^{-1}(y)
\right)}{g^\prime(g^{-1}(y))}
\end{align}
$$

ちなみに最後の式は逆関数の微分から得られる。念のために式変形を載せておく。
$$
\begin{align}
x &= g^{-1}(y)\\
1 &= \frac{dg^{-1}(y)}{dy}\frac{dy}{dx}~~~~(\leftarrow 両辺xで微分)\\
&= \frac{dg^{-1}(y)}{dy}\frac{dg(x)}{dx}~~~~(\leftarrow y=g(x)を利用)\\
&= \frac{dg^{-1}(y)}{dy}g^\prime(x)\\
\frac{dg^{-1}(y)}{dy} 
&= \frac{1}{g^\prime(x)} = \frac{1}{g^\prime(g^{-1}(y))}
\end{align}
$$


## <span style="color:blue">§ 逆関数法：一様乱数から目的の確率分布を作る手法</span>
ある関数による変換でどのような確立分布が得られるか分かる様になったので、逆関数法を紹介する。これは一様乱数から狙った確率分布を持つ乱数を作る方法であり、結構有用である。
ここでの仮定として、以下が準備出来ているとする。
- 1 : 区間$[0,1]$の一様乱数は作れる。
- 2 : 作りたい分布の累積分布関数が分かっている。

まずはゴールを明確にしよう。目的の乱数を得たいということは、それは即ち「コンピューターで一様乱数を生成して、それにある関数 $y = g(x)$ を作用させると、yが欲しかった確率分布になっている」ような関数$g(x)$を見つけたいという事に等しい。関数$g$を見つける事がゴールという事を念頭に置いておこう。

さて、まずは累積分布関数の定義に立ち返ってみる。
$$
F(y) = \int_{-\infty}^y \tilde{\rho}(t)dt
$$
（改めて言うが、積分領域の下端は別にマイナス無限大である必要はない）  
この式の両辺を$y$で微分すると、以下が得られる。 
$$
\frac{dF(y)}{dy} = \tilde{\rho}(y)$$


さて、一方で確率密度の変換則を思い出そう。
$$
\tilde{\rho}(y)~=~\rho(f(y))\frac{dg^{-1}(y)}{dy}
$$
ここで仮定の１番を思い出すと、変換前の確率密度は一様なので $\rho(x) = 1$ だと言える。つまりこのケースにおいて変換則の右辺第一項は1になる為、以下の式を得る。
$$
\tilde{\rho}(y)~=~\frac{dg^{-1}(y)}{dy}
$$
この左辺は先ほど導出した累積分布関数の微分に等しい。よって以下を得る。
$$
\frac{dF(y)}{dy}~=~\frac{dg^{-1}(y)}{dy}
$$

これはつまり、 $F(y) = g^{-1}(y) \to g(x) = F^{-1}(x)$という事であり、欲しかった変換関数 $g(x)$ は累積分布関数の逆関数に等しいことが分かった。

### ・応用
二次元の応用になってしまうが、半径１の円内部に一様に点を振りたいとして、極座標を利用して$r\in [0,1],\theta\in[0, 2\pi]$で一様乱数を発生させ、
$$
x = r\cos\theta\\
y = r\sin\theta\\
$$
というよくある形式で変換すると、確かに円内部に点を振ることは出来るが、均等にはならず中心に寄った分布になってしまう。これは$r$が大きいところでは面積$(rdrd\theta)$が大きくなり、その分密度としては減ってしまうからだ。